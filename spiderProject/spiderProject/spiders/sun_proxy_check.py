import requests
from queue import Queue
import threading
import time

class climbvideo():
    def __init__(self):
        self.data = [
            "http://136.243.211.104:80",
"http://176.235.99.103:9090",
"http://39.106.223.134:80",
"http://39.102.32.69:3128",
"http://167.71.5.83:8080",
"http://200.155.139.242:3128",
"http://197.210.107.74:80",
"http://120.55.39.108:80",
"http://47.113.111.149:80",
"http://103.17.102.3:8080",
"http://200.6.136.94:8080",
"http://23.97.173.57:80",
"http://197.155.83.17:8080",
"http://41.202.221.102:8080",
"http://8.129.126.49:80",
"http://103.78.254.78:80",
"http://188.126.38.185:80",
"http://195.9.173.38:63141",
"http://110.164.93.44:8080",
"http://138.68.60.8:3128",
"http://118.179.223.130:80",
"http://132.248.196.2:8080",
"http://114.112.127.49:80",
"http://103.28.121.58:80",
"http://103.4.164.205:8080",
"http://45.167.125.129:9991",
"http://116.73.14.16:8080",
"http://141.226.18.206:8080",
"http://47.115.15.170:80",
"http://103.148.216.5:80",
"http://8.129.48.86:80",
"http://191.7.20.94:3128",
"http://36.94.84.146:8080",
"http://45.184.103.113:999",
"http://49.85.189.88:8007",
"http://194.150.255.142:80",
"http://116.117.134.135:9999",
"http://176.9.119.170:8080",
"http://46.4.168.53:80",
"http://47.115.142.42:80",
"http://183.88.226.50:8080",
"http://47.115.116.5:80",
"http://118.194.242.48:80",
"http://37.113.132.8:8080",
"http://198.199.86.11:3128",
"http://52.78.172.171:80",
"http://222.112.240.144:80",
"http://165.227.163.91:3128",
"http://142.44.148.56:8080",
"http://121.230.91.216:8089",
"http://72.23.14.208:80",
"http://14.225.11.126:8080",
"http://180.183.10.80:8213",
"http://115.127.162.170:8080",
"http://180.183.112.76:8213",
"http://47.56.4.34:80",
"http://103.248.137.31:80",
"http://183.88.99.52:8213",
"http://201.91.82.155:3128",
"http://91.149.134.171:3128",
"http://47.112.237.208:80",
"http://114.233.171.61:8091",
"http://49.85.188.123:8097",
"http://005.252.161.48:8080",
"http://187.44.1.167:8080",
"http://114.233.170.29:8004",
"http://154.16.202.22:3128",
"http://78.47.16.54:80",
"http://128.199.202.122:3128",
"http://113.254.178.224:8193",
"http://121.230.91.229:8022",
"http://189.206.105.163:80",
"http://37.135.121.157:80",
"http://193.149.225.72:80",
"http://139.162.78.109:8080",
"http://47.75.90.57:80",
"http://47.57.188.208:80",
"http://124.205.153.25:80",
"http://191.96.42.80:8080",
"http://47.112.152.228:80",
"http://120.232.150.100:80",
"http://151.22.181.223:8080",
"http://84.201.243.206:80",
"http://191.96.71.118:3128",
"http://52.151.15.4:80",
"http://197.211.51.28:3128",
"http://134.209.29.120:8080",
"http://151.22.181.213:8080",
"http://125.141.117.34:80",
"http://210.48.204.134:46669",
"http://143.137.204.5:80",
"http://94.199.75.171:8080",
"http://182.253.34.129:8080",
"http://46.101.107.98:8888",
"http://202.173.121.14:3128",
"http://8.210.71.64:3128",
"http://89.20.48.118:8080",
"http://118.250.3.37:8060",
"http://47.112.154.149:80",
"http://117.28.246.15:80",
"http://95.208.208.227:3128",
"http://219.92.3.149:8080",
"http://216.21.18.194:80",
"http://118.194.242.149:80",
"http://52.149.152.236:80",
"http://14.119.82.122:80",
"http://114.112.127.54:80",
"http://202.57.55.242:45112",
"http://118.163.94.3:80",
"http://181.98.174.28:80",
"http://187.188.181.112:1994",
"http://103.120.144.144:80",
"http://103.56.208.250:8080",
"http://101.132.111.208:8082",
"http://43.129.20.96:80",
"http://137.59.155.14:80",
"http://46.4.96.137:3128",
"http://8.210.155.56:80",
"http://85.198.250.135:3128",
"http://27.124.44.77:80",
"http://120.196.112.6:3128",
"http://117.187.167.224:3128",
"http://49.85.189.77:8061",
"http://149.54.10.226:8080",
"http://41.76.155.134:8080",
"http://197.248.30.123:80",
"http://103.89.152.190:8080",
"http://102.176.160.84:8080",
"http://05.252.161.48:8080",
"http://132.145.18.53:80",
"http://120.77.215.57:80",
"http://161.35.70.249:3128",
"http://45.173.4.244:999",
"http://88.198.50.103:3128",
"http://187.60.121.246:3128",
"http://112.245.17.202:8080",
"http://186.157.242.229:8080",
"http://183.89.78.48:8080",
"http://118.194.242.156:80",
"http://52.142.220.26:80",
"http://154.16.63.16:3128",
"http://36.91.69.82:8080",
"http://51.158.178.209:8888",
"http://178.128.143.54:8080",
"http://47.95.205.25:8080",
"http://176.9.75.42:3128",
"http://177.70.172.244:8080",
"http://47.116.76.219:80",
"http://160.119.192.254:8080",
"http://190.248.153.162:8080",
"http://114.5.199.203:8080",
"http://43.229.252.28:53281",
"http://91.202.230.219:8080",
"http://103.130.4.82:8080",
"http://5.252.161.48:3128",
"http://85.114.120.201:999",
"http://47.99.209.194:80",
"http://113.121.242.158:57114",
"http://79.120.177.106:8080",
"http://121.230.90.214:8009",
"http://189.206.105.164:80",
"http://45.32.31.97:80",
"http://121.230.90.229:8007",
"http://116.117.134.134:80",
"http://106.53.233.125:3128",
"http://47.89.153.213:80",
"http://101.109.190.22:8080",
"http://139.59.1.14:3128",
"http://114.233.169.200:8087",
"http://47.115.32.249:80",
"http://102.129.249.120:8080",
"http://168.228.195.90:999",
"http://14.7.183.127:80",
"http://182.253.175.238:8080",
"http://203.202.245.58:80",
"http://118.194.242.50:80",
"http://77.68.125.33:80",
"http://149.28.213.28:80",
"http://94.181.48.110:1256",
"http://75.119.144.28:80",
"http://13.231.68.213:8081",
"http://78.142.232.116:8080",
"http://91.89.89.13:8080",
"http://218.147.194.40:80",
"http://103.98.128.51:8080",
"http://123.194.89.104:80",
"http://106.51.252.230:80",
"http://120.232.150.110:80",
"http://103.227.254.118:1990",
"http://8.129.123.133:80",
"http://80.211.179.30:3128",
"http://161.97.149.38:8888",
"http://198.24.170.162:8001",
"http://209.91.216.173:8080",
"http://60.255.151.82:80",
"http://47.112.237.100:80",
"http://202.83.125.254:80",
"http://213.33.236.94:8081",
"http://58.240.52.114:80",
"http://45.174.251.29:999",
"http://101.133.216.135:80",
"http://103.51.103.22:80",
"http://159.203.61.169:8080",
"http://106.14.198.6:8080",
"http://102.67.19.132:8080",
"http://209.97.150.167:8080",
"http://186.225.46.90:8080",
"http://58.176.147.14:80",
"http://202.61.51.204:3128",
"http://193.56.157.39:8080",
"http://186.103.203.206:999",
"http://121.230.91.185:8070",
"http://200.93.199.141:80",
"http://102.164.252.175:8080",
"http://223.255.133.34:8080",
"http://88.198.24.108:8080",
"http://103.35.132.18:83",
"http://218.147.194.39:80",
"http://85.105.139.53:8090",
"http://35.172.135.29:80",
"http://129.205.160.233:60643",


        ]
        self.headers = {
            'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.190 Safari/537.36'
        }
        self.threads = [] #创建一个线程池
        self.threads_nums = 100 #设置10个线程
        self.start_time = time.time() #开始时间
        self.result = []


    #1、给队列添加值
    def queue_ssignment(self):

        self.link_queue = Queue()  # 创建队列对象
        for item in self.data:
            self.link_queue.put(item)  # 添加到队列

        # 打印队列中的值 - 查看有啥内容
        # while not self.link_queue.empty():
        #     print(self.link_queue.get())
        # print(self.link_queue.qsize())
        self.setThreads()

    # 2、线程控制
    def setThreads(self):
        for i in range(self.threads_nums):
            t = threading.Thread(target=self.business_module)  # 创建一个线程
            t.start()  # 启动线程
            self.threads.append(t)  # 添加到线程池

        # 阻塞队列,直到队列被清空才会继续往下执行
        self.link_queue.join()
        # 向队列发送N个None,通知线程退出
        for i in range(self.threads_nums):
            self.link_queue.put(None)
        # 阻塞主线程,直到退出主线程
        for t in self.threads:
            t.join()
        cost_seconds = time.time() - self.start_time
        print('处理完成,用时 %.2f 秒' % cost_seconds)
        #print(self.link_queue.qsize()) #打印队列是否都消费完

    #3、队列中元素移除
    def business_module(self):
        while True:
            link = self.link_queue.get()  # 阻塞,直到从队列中取得一条消息,说明:这里获取不到数据,不会往下执行,阻塞形式
            #print("A %s Z" % link)
            if link is None:  # 如果取到的数据是None,则退出循环,线程即可也消失
                break
            self.sun_proxy(link)  # 把从消息队列中获取的值,传给爬虫函数,执行操作
            #print(link)
            self.link_queue.task_done()  # 执行到这里,告诉队列,本次循环执行完了,它会从队列里面删掉一条数据
            #print('队列中剩余 %d 条数据' % self.link_queue.qsize())

    #4、业务逻辑模块
    def sun_proxy(self,level2_url):
        scheme = urlparse(level2_url).scheme
        netloc = scheme+'://'+urlparse(level2_url).netloc
        proxies = {scheme:netloc}
        # print(proxies)
        try:
            r2 = requests.get('http://httpbin.org/get', headers=self.headers,proxies=proxies, timeout=3)
            if r2.status_code == 200:
                print('服务器检测到我们的IP地址:%s' % r2.json()['origin'])
                self.result.append(level2_url)
        except Exception as result:
            print(result)
            pass

from urllib.parse import urlparse
if __name__=='__main__':
    sun = climbvideo()
    sun.queue_ssignment()
    print('-'*50)
    print('一下是可用代理')
    for item in sun.result:
        print("'%s'," % item)